<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bars Verification</title>
    <script type="module" src="./packages/core/dist/siemens-ix/siemens-ix.esm.js"></script>
    <link rel="stylesheet" href="./packages/core/dist/siemens-ix/siemens-ix.css">
    <style>
        body {
            background: #1a1a1a;
            color: white;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        .test-section {
            border: 1px solid #333;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .success { background: rgba(1, 214, 90, 0.2); border-left: 4px solid #01d65a; }
        .error { background: rgba(255, 38, 64, 0.2); border-left: 4px solid #ff2640; }
    </style>
</head>
<body>
    <h1>Bars Verification Test</h1>

    <div class="test-section">
        <h2>Test 1: Device Status Chart (Default Data)</h2>
        <ix-device-status-chart id="chart1"></ix-device-status-chart>
        <div id="result1" class="result"></div>
    </div>

    <div class="test-section">
        <h2>Test 2: Device Status Chart (Custom JSON Data)</h2>
        <ix-device-status-chart
            id="chart2"
            data='{"Web Servers": {"success": 15, "warning": 2, "alarm": 1, "critical": 0}, "DB Servers": {"success": 8, "warning": 1, "alarm": 0, "critical": 1}}'
        ></ix-device-status-chart>
        <div id="result2" class="result"></div>
    </div>

    <div class="test-section">
        <h2>Test 3: Custom Card</h2>
        <ix-custom-card id="customCard"></ix-custom-card>
        <div id="result3" class="result"></div>
    </div>

    <script>
        function testChart(chartId, resultId, expectedBars) {
            const chart = document.getElementById(chartId);
            const resultDiv = document.getElementById(resultId);

            if (!chart) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = '‚ùå Chart element not found';
                return false;
            }

            if (!chart.shadowRoot) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = '‚ùå Shadow root not found';
                return false;
            }

            const bars = chart.shadowRoot.querySelectorAll('.bar');
            const barContainers = chart.shadowRoot.querySelectorAll('.bar-container');

            if (bars.length === 0) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `‚ùå No bars found (${barContainers.length} containers)`;
                return false;
            }

            resultDiv.className = 'result success';
            resultDiv.innerHTML = `‚úÖ SUCCESS: ${bars.length} bars found in ${barContainers.length} containers`;

            // Log bar details
            bars.forEach((bar, i) => {
                const rect = bar.getBoundingClientRect();
                const classes = bar.className;
                console.log(`${chartId} Bar ${i}: ${rect.width}px, classes: ${classes}`);
            });

            return true;
        }

        // Run tests after components load
        setTimeout(() => {
            console.log('=== Bars Verification Test Results ===');

            const test1 = testChart('chart1', 'result1');
            const test2 = testChart('chart2', 'result2');
            const test3 = testChart('customCard', 'result3');

            const allPassed = test1 && test2 && test3;

            console.log(`\n=== FINAL RESULT ===`);
            console.log(allPassed ? 'üéâ ALL TESTS PASSED!' : '‚ùå Some tests failed');

            // Add summary to page
            const summary = document.createElement('div');
            summary.className = `result ${allPassed ? 'success' : 'error'}`;
            summary.innerHTML = `<h2>Overall Result: ${allPassed ? '‚úÖ ALL TESTS PASSED' : '‚ùå SOME TESTS FAILED'}</h2>`;
            document.body.appendChild(summary);

        }, 3000);
    </script>
</body>
</html>
