<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠ¨æ€æ•°æ®å±•ç¤ºæµ‹è¯•</title>
    <script type="module" src="./packages/core/dist/siemens-ix/siemens-ix.esm.js"></script>
    <link rel="stylesheet" href="./packages/core/dist/siemens-ix/siemens-ix.css">
    <style>
        body {
            background: #1a1a1a;
            color: white;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        .test-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
        }
        .success { background: rgba(1, 214, 90, 0.2); color: #01d65a; }
        .error { background: rgba(255, 38, 64, 0.2); color: #ff2640; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>ğŸ”„ åŠ¨æ€æ•°æ®å±•ç¤ºæµ‹è¯•</h1>

    <div class="test-section">
        <h3>æµ‹è¯•1: é»˜è®¤Mockæ•°æ®</h3>
        <ix-device-status-chart id="chart1"></ix-device-status-chart>
        <div id="result1" class="result">æ£€æµ‹ä¸­...</div>
    </div>

    <div class="test-section">
        <h3>æµ‹è¯•2: åŠ¨æ€æ•°æ®æ›´æ–°</h3>
        <ix-device-status-chart id="chart2"></ix-device-status-chart>
        <button onclick="updateData()">æ›´æ–°æ•°æ®</button>
        <button onclick="resetData()">é‡ç½®æ•°æ®</button>
        <div id="result2" class="result">æ£€æµ‹ä¸­...</div>
    </div>

    <div class="test-section">
        <h3>æµ‹è¯•3: Custom Cardé›†æˆ</h3>
        <ix-custom-card id="customCard"></ix-custom-card>
        <div id="result3" class="result">æ£€æµ‹ä¸­...</div>
    </div>

    <script>
        console.log('ğŸ”„ åŠ¨æ€æ•°æ®å±•ç¤ºæµ‹è¯•å¼€å§‹');

        function checkChart(chartId, resultId, description) {
            const chart = document.getElementById(chartId);
            const resultDiv = document.getElementById(resultId);

            if (!chart || !chart.shadowRoot) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ ${description}: ç»„ä»¶æœªåŠ è½½`;
                return false;
            }

            const bars = chart.shadowRoot.querySelectorAll('.bar');
            const visibleBars = Array.from(bars).filter(bar => {
                const style = window.getComputedStyle(bar);
                return style.width !== '0px' && style.height !== '0px' && style.display !== 'none';
            });

            if (visibleBars.length > 0) {
                resultDiv.className = 'result success';
                resultDiv.textContent = `âœ… ${description}: ${visibleBars.length} ä¸ªæ¡å½¢å›¾æ­£å¸¸æ˜¾ç¤º`;
                return true;
            } else {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ ${description}: æ¡å½¢å›¾æœªæ˜¾ç¤º (${bars.length} ä¸ªå…ƒç´ å­˜åœ¨ä½†ä¸å¯è§)`;
                return false;
            }
        }

        // åŠ¨æ€æ•°æ®æ›´æ–°å‡½æ•°
        function updateData() {
            const chart = document.getElementById('chart2');
            const newData = {
                'ç”Ÿäº§ç¯å¢ƒ': { success: Math.floor(Math.random() * 200), warning: Math.floor(Math.random() * 50), alarm: Math.floor(Math.random() * 20), critical: Math.floor(Math.random() * 10) },
                'æµ‹è¯•ç¯å¢ƒ': { success: Math.floor(Math.random() * 100), warning: Math.floor(Math.random() * 30), alarm: Math.floor(Math.random() * 10), critical: Math.floor(Math.random() * 5) },
                'å¼€å‘ç¯å¢ƒ': { success: Math.floor(Math.random() * 80), warning: Math.floor(Math.random() * 20), alarm: Math.floor(Math.random() * 5), critical: Math.floor(Math.random() * 3) }
            };
            chart.data = JSON.stringify(newData);
            console.log('æ•°æ®å·²æ›´æ–°:', newData);

            setTimeout(() => checkChart('chart2', 'result2', 'åŠ¨æ€æ›´æ–°'), 500);
        }

        function resetData() {
            const chart = document.getElementById('chart2');
            chart.data = JSON.stringify({
                '10.x': { success: 60, warning: 0, alarm: 0, critical: 0 },
                '192.x': { success: 250, warning: 0, alarm: 26, critical: 15 },
                '172.x': { success: 180, warning: 49, alarm: 0, critical: 0 }
            });
            console.log('æ•°æ®å·²é‡ç½®');

            setTimeout(() => checkChart('chart2', 'result2', 'é‡ç½®æ•°æ®'), 500);
        }

        // åˆå§‹åŒ–æµ‹è¯•
        setTimeout(() => {
            const results = [
                checkChart('chart1', 'result1', 'é»˜è®¤æ•°æ®'),
                checkChart('chart2', 'result2', 'åŠ¨æ€æ•°æ®'),
                checkChart('customCard', 'result3', 'Custom Card')
            ];

            const successCount = results.filter(r => r).length;
            console.log(`æµ‹è¯•ç»“æœ: ${successCount}/3 ä¸ªå›¾è¡¨æ­£å¸¸å·¥ä½œ`);

            if (successCount === 3) {
                document.querySelector('h1').innerHTML = 'ğŸ‰ åŠ¨æ€æ•°æ®å±•ç¤ºæµ‹è¯• - å…¨éƒ¨æˆåŠŸï¼';
                document.querySelector('h1').style.color = '#01d65a';
            } else if (successCount > 0) {
                document.querySelector('h1').innerHTML = `âš ï¸ åŠ¨æ€æ•°æ®å±•ç¤ºæµ‹è¯• - éƒ¨åˆ†æˆåŠŸ (${successCount}/3)`;
                document.querySelector('h1').style.color = '#ffd732';
            } else {
                document.querySelector('h1').innerHTML = 'âŒ åŠ¨æ€æ•°æ®å±•ç¤ºæµ‹è¯• - å¤±è´¥';
                document.querySelector('h1').style.color = '#ff2640';
            }
        }, 2000);
    </script>
</body>
</html>
