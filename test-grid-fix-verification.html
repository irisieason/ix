<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grid Fix Verification</title>
    <script type="module" src="./packages/core/dist/siemens-ix/siemens-ix.esm.js"></script>
    <link rel="stylesheet" href="./packages/core/dist/siemens-ix/siemens-ix.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            margin: 0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1, h2 {
            text-align: center;
        }
        .test-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 30px 0;
        }
        .test-section {
            padding: 20px;
            border: 2px solid #333;
            border-radius: 8px;
        }
        .dark-bg {
            background-color: #1a1a1a;
            color: white;
        }
        .light-bg {
            background-color: #f6f9fc;
            color: #333;
        }
        .card-container {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            padding: 20px;
            border: 1px dashed #666;
            border-radius: 4px;
        }
        .status-info {
            background: #333;
            color: white;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            margin: 20px 0;
        }
        .light-bg .status-info {
            background: #e0e0e0;
            color: #333;
        }
        .checklist {
            margin: 15px 0;
        }
        .checklist li {
            margin: 8px 0;
            padding: 5px;
            border-radius: 3px;
        }
        .pass {
            background-color: rgba(1, 214, 90, 0.2);
            color: #01d65a;
        }
        .fail {
            background-color: rgba(255, 38, 64, 0.2);
            color: #ff2640;
        }
        .pending {
            background-color: rgba(255, 215, 50, 0.2);
            color: #ffd732;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ç½‘æ ¼çº¿å’ŒæŸ±çŠ¶å›¾ä¿®å¤éªŒè¯</h1>

        <div class="status-info">
            <strong>ä¿®å¤å†…å®¹ï¼š</strong><br>
            âœ… ä½¿ç”¨ç»å¯¹é¢œè‰²å€¼ rgba(235, 240, 245, 0.4) æ›¿ä»£ CSS å˜é‡<br>
            âœ… æ·»åŠ  !important å£°æ˜ç¡®ä¿æ ·å¼ä¼˜å…ˆçº§<br>
            âœ… ä¸ºç½‘æ ¼çº¿æ·»åŠ å¤šé‡æ ·å¼ä¿éšœï¼ˆbackground-color + background + border-rightï¼‰<br>
            âœ… ä¸ºæŸ±çŠ¶å›¾å’Œå›¾ä¾‹æ·»åŠ  !important å£°æ˜<br>
            âœ… æ·»åŠ  display: block !important ç¡®ä¿å…ƒç´ æ˜¾ç¤º
        </div>

        <div class="test-grid">
            <!-- æ·±è‰²èƒŒæ™¯æµ‹è¯• -->
            <div class="test-section dark-bg">
                <h2>æ·±è‰²èƒŒæ™¯ï¼ˆHTML ç¯å¢ƒï¼‰</h2>
                <div class="card-container">
                    <ix-custom-card id="dark-card"></ix-custom-card>
                </div>
                <div class="status-info">
                    <strong>æ£€æŸ¥ç»“æœï¼š</strong>
                    <ul class="checklist" id="dark-checklist">
                        <li class="pending">ğŸ”„ æ£€æŸ¥ä¸­...</li>
                    </ul>
                </div>
            </div>

            <!-- æµ…è‰²èƒŒæ™¯æµ‹è¯• -->
            <div class="test-section light-bg">
                <h2>æµ…è‰²èƒŒæ™¯ï¼ˆæ¨¡æ‹Ÿ Storybookï¼‰</h2>
                <div class="card-container" style="background: white; border-color: #ddd;">
                    <ix-custom-card id="light-card"></ix-custom-card>
                </div>
                <div class="status-info">
                    <strong>æ£€æŸ¥ç»“æœï¼š</strong>
                    <ul class="checklist" id="light-checklist">
                        <li class="pending">ğŸ”„ æ£€æŸ¥ä¸­...</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="status-info">
            <h3>æ€»ä½“ç»“æœ</h3>
            <div id="overall-result">æ£€æŸ¥ä¸­...</div>
        </div>

        <div class="status-info">
            <h3>ä¸‹ä¸€æ­¥</h3>
            <div>
                å¦‚æœæµ…è‰²èƒŒæ™¯æµ‹è¯•é€šè¿‡ï¼Œè¯´æ˜ Storybook ä¸­çš„ç½‘æ ¼çº¿å’ŒæŸ±çŠ¶å›¾é—®é¢˜å·²è§£å†³ã€‚<br>
                å¦‚æœä»æœ‰é—®é¢˜ï¼Œå¯èƒ½éœ€è¦ï¼š<br>
                â€¢ æ£€æŸ¥ Storybook çš„å…·ä½“ CSS ç¯å¢ƒ<br>
                â€¢ ä½¿ç”¨ SVG æˆ– Canvas ç»˜åˆ¶å›¾è¡¨<br>
                â€¢ æ”¹ç”¨ DOM å…ƒç´ è€Œé CSS ç»˜åˆ¶
            </div>
        </div>
    </div>

    <script>
        window.addEventListener('load', () => {
            setTimeout(() => {
                console.log('=== Grid Fix Verification ===');

                const darkCard = document.getElementById('dark-card');
                const lightCard = document.getElementById('light-card');
                const darkChecklist = document.getElementById('dark-checklist');
                const lightChecklist = document.getElementById('light-checklist');

                function checkCard(card, checklist, envName) {
                    const results = [];

                    if (!card || !card.shadowRoot) {
                        results.push({ text: `âŒ ${envName}: ç»„ä»¶æœªæ‰¾åˆ°`, class: 'fail' });
                        return results;
                    }

                    const shadowRoot = card.shadowRoot;

                    // æ£€æŸ¥ç½‘æ ¼çº¿
                    const verticalLines = shadowRoot.querySelectorAll('.grid-line');
                    const horizontalLines = shadowRoot.querySelectorAll('.horizontal-grid-line');
                    const bottomLine = shadowRoot.querySelectorAll('.bottom-horizontal-line');

                    results.push({
                        text: `å‚ç›´ç½‘æ ¼çº¿: ${verticalLines.length}/7 ä¸ª`,
                        class: verticalLines.length === 7 ? 'pass' : 'fail'
                    });

                    results.push({
                        text: `æ°´å¹³ç½‘æ ¼çº¿: ${horizontalLines.length + bottomLine.length}/4 ä¸ª`,
                        class: (horizontalLines.length + bottomLine.length) === 4 ? 'pass' : 'fail'
                    });

                    // æ£€æŸ¥ç½‘æ ¼çº¿æ ·å¼
                    if (verticalLines.length > 0) {
                        const lineStyle = window.getComputedStyle(verticalLines[0]);
                        const hasBackground = lineStyle.backgroundColor !== 'rgba(0, 0, 0, 0)' &&
                                            lineStyle.backgroundColor !== 'transparent';
                        results.push({
                            text: `å‚ç›´çº¿å¯è§æ€§: ${hasBackground ? 'âœ… æœ‰èƒŒæ™¯è‰²' : 'âŒ æ— èƒŒæ™¯è‰²'}`,
                            class: hasBackground ? 'pass' : 'fail'
                        });

                        console.log(`${envName} å‚ç›´çº¿æ ·å¼:`, {
                            backgroundColor: lineStyle.backgroundColor,
                            background: lineStyle.background,
                            opacity: lineStyle.opacity,
                            visibility: lineStyle.visibility,
                            display: lineStyle.display
                        });
                    }

                    // æ£€æŸ¥æŸ±çŠ¶å›¾
                    const bars = shadowRoot.querySelectorAll('.bar');
                    results.push({
                        text: `æŸ±çŠ¶å›¾å…ƒç´ : ${bars.length} ä¸ª`,
                        class: bars.length > 0 ? 'pass' : 'fail'
                    });

                    if (bars.length > 0) {
                        const barStyle = window.getComputedStyle(bars[0]);
                        const hasBarBackground = barStyle.backgroundColor !== 'rgba(0, 0, 0, 0)' &&
                                               barStyle.backgroundColor !== 'transparent';
                        results.push({
                            text: `æŸ±çŠ¶å›¾å¯è§æ€§: ${hasBarBackground ? 'âœ… æœ‰èƒŒæ™¯è‰²' : 'âŒ æ— èƒŒæ™¯è‰²'}`,
                            class: hasBarBackground ? 'pass' : 'fail'
                        });

                        console.log(`${envName} æŸ±çŠ¶å›¾æ ·å¼:`, {
                            backgroundColor: barStyle.backgroundColor,
                            opacity: barStyle.opacity,
                            visibility: barStyle.visibility,
                            display: barStyle.display
                        });
                    }

                    // æ£€æŸ¥å›¾ä¾‹
                    const legendItems = shadowRoot.querySelectorAll('.legend-item');
                    results.push({
                        text: `å›¾ä¾‹å…ƒç´ : ${legendItems.length}/4 ä¸ª`,
                        class: legendItems.length === 4 ? 'pass' : 'fail'
                    });

                    return results;
                }

                // æ£€æŸ¥ä¸¤ä¸ªç¯å¢ƒ
                const darkResults = checkCard(darkCard, darkChecklist, 'æ·±è‰²èƒŒæ™¯');
                const lightResults = checkCard(lightCard, lightChecklist, 'æµ…è‰²èƒŒæ™¯');

                // æ›´æ–°æ£€æŸ¥åˆ—è¡¨
                function updateChecklist(checklist, results) {
                    checklist.innerHTML = results.map(result =>
                        `<li class="${result.class}">${result.text}</li>`
                    ).join('');
                }

                updateChecklist(darkChecklist, darkResults);
                updateChecklist(lightChecklist, lightResults);

                // è®¡ç®—æ€»ä½“ç»“æœ
                const allResults = [...darkResults, ...lightResults];
                const passCount = allResults.filter(r => r.class === 'pass').length;
                const totalCount = allResults.length;
                const successRate = Math.round((passCount / totalCount) * 100);

                const overallResult = document.getElementById('overall-result');
                if (successRate >= 80) {
                    overallResult.innerHTML = `ğŸ‰ ä¿®å¤æˆåŠŸï¼é€šè¿‡ç‡: ${successRate}% (${passCount}/${totalCount})`;
                    overallResult.style.color = '#01d65a';
                } else if (successRate >= 50) {
                    overallResult.innerHTML = `âš ï¸ éƒ¨åˆ†ä¿®å¤ã€‚é€šè¿‡ç‡: ${successRate}% (${passCount}/${totalCount})`;
                    overallResult.style.color = '#ffd732';
                } else {
                    overallResult.innerHTML = `âŒ ä¿®å¤å¤±è´¥ã€‚é€šè¿‡ç‡: ${successRate}% (${passCount}/${totalCount})`;
                    overallResult.style.color = '#ff2640';
                }

                console.log('Verification complete:', {
                    darkResults,
                    lightResults,
                    successRate,
                    passCount,
                    totalCount
                });
            }, 2000);
        });
    </script>
</body>
</html>
