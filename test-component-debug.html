<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Component Debug Test</title>
    <script type="module" src="./packages/core/dist/siemens-ix/siemens-ix.esm.js"></script>
    <link rel="stylesheet" href="./packages/core/dist/siemens-ix/siemens-ix.css">
    <style>
        body {
            margin: 0;
            padding: 20px;
            background-color: #1a1a1a;
            color: white;
            font-family: Arial, sans-serif;
        }
        .debug-container {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .debug-info {
            background: #333;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>StatusHistoryChart Component Debug</h1>

    <div class="debug-container">
        <h2>Component Loading Test</h2>
        <div class="debug-info" id="loading-info">Checking component loading...</div>

        <ix-status-history-chart
            id="test-chart"
            chart-title="Debug Test Chart"
            data='{"Jan": {"online": 10, "maintenance": 0, "error": 0, "offline": -100}, "Feb": {"online": 5, "maintenance": -5, "error": 0, "offline": -40}, "Mar": {"online": -10, "maintenance": -60, "error": -20, "offline": -40}}'>
        </ix-status-history-chart>

        <div class="debug-info" id="component-info">Component info will appear here...</div>
    </div>

    <script>
        function debugComponent() {
            const chart = document.getElementById('test-chart');
            const loadingInfo = document.getElementById('loading-info');
            const componentInfo = document.getElementById('component-info');

            let debugText = '';

            // Check if component exists
            debugText += `Component element: ${chart ? 'Found' : 'Not found'}\n`;

            if (chart) {
                debugText += `Tag name: ${chart.tagName}\n`;
                debugText += `Shadow root: ${chart.shadowRoot ? 'Exists' : 'Missing'}\n`;

                if (chart.shadowRoot) {
                    const xAxisLabels = chart.shadowRoot.querySelector('.x-axis-labels');
                    const xLabels = chart.shadowRoot.querySelectorAll('.x-label');
                    const verticalLines = chart.shadowRoot.querySelectorAll('.grid-lines line[x1]');

                    debugText += `X-axis labels container: ${xAxisLabels ? 'Found' : 'Missing'}\n`;
                    debugText += `X-labels count: ${xLabels.length}\n`;
                    debugText += `Vertical lines count: ${verticalLines.length}\n`;

                    // Check each label's style
                    xLabels.forEach((label, index) => {
                        const style = label.getAttribute('style');
                        const text = label.textContent?.trim();
                        debugText += `Label ${index} "${text}": ${style}\n`;
                    });

                    // Check vertical line positions
                    verticalLines.forEach((line, index) => {
                        const x1 = line.getAttribute('x1');
                        debugText += `Vertical line ${index}: x1=${x1}\n`;
                    });
                }

                // Check component properties
                debugText += `Chart title: ${chart.chartTitle || chart.getAttribute('chart-title')}\n`;
                debugText += `Data attribute: ${chart.getAttribute('data')}\n`;
            }

            componentInfo.textContent = debugText;
            loadingInfo.textContent = 'Component analysis complete.';
        }

        // Wait for component to load
        setTimeout(debugComponent, 1000);

        // Also check when component is defined
        if (customElements.get('ix-status-history-chart')) {
            console.log('ix-status-history-chart is already defined');
        } else {
            customElements.whenDefined('ix-status-history-chart').then(() => {
                console.log('ix-status-history-chart is now defined');
                setTimeout(debugComponent, 500);
            });
        }
    </script>
</body>
</html>
