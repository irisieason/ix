<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chart Components Comprehensive Test</title>
    <script type="module" src="packages/core/dist/siemens-ix/siemens-ix.esm.js"></script>
    <link rel="stylesheet" href="packages/core/dist/siemens-ix/siemens-ix.css">
    <style>
        body {
            background-color: #1a1a1a;
            color: white;
            font-family: 'Siemens Sans Global', sans-serif;
            padding: 20px;
            margin: 0;
            line-height: 1.6;
        }
        .test-container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: linear-gradient(135deg, #2a2a2a, #3a3a3a);
            border-radius: 8px;
        }
        .test-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }
        .test-section {
            background-color: #2a2a2a;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 20px;
        }
        .section-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #4CAF50;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 5px;
        }
        .chart-container {
            margin: 15px 0;
            border: 1px solid #555;
            border-radius: 4px;
            overflow: hidden;
            background-color: #1a1a1a;
        }
        .test-info {
            background-color: #333;
            padding: 10px;
            border-radius: 4px;
            font-size: 12px;
            margin-top: 10px;
            font-family: monospace;
        }
        .status-good { color: #4CAF50; }
        .status-warning { color: #ff9800; }
        .status-error { color: #f44336; }
        .controls {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
        }
        .btn-primary { background: #4CAF50; color: white; }
        .btn-secondary { background: #2196F3; color: white; }
        .btn-warning { background: #ff9800; color: white; }
        .full-width {
            grid-column: 1 / -1;
        }
        .comparison-section {
            background-color: #2a2a2a;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }
        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        .feature-list {
            background-color: #333;
            padding: 15px;
            border-radius: 4px;
            margin-top: 15px;
        }
        .feature-list h4 {
            margin-top: 0;
            color: #4CAF50;
        }
        .feature-list ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        .feature-list li {
            margin: 5px 0;
        }
        .console-output {
            background-color: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="header">
            <h1>ğŸ“Š Chart Components Comprehensive Test</h1>
            <p>å…¨é¢æµ‹è¯•æ–°å¢çš„ DeviceStatusChart å’Œ StatusHistoryChart ç»„ä»¶</p>
            <div id="overall-status" class="status-warning">æ­£åœ¨åˆå§‹åŒ–æµ‹è¯•...</div>
        </div>

        <!-- åŸºç¡€åŠŸèƒ½æµ‹è¯• -->
        <div class="test-grid">
            <!-- DeviceStatusChart æµ‹è¯• -->
            <div class="test-section">
                <div class="section-title">ğŸ“ˆ DeviceStatusChart æµ‹è¯•</div>

                <h4>é»˜è®¤é…ç½®</h4>
                <div class="chart-container">
                    <ix-device-status-chart id="device-default"></ix-device-status-chart>
                </div>

                <h4>è‡ªå®šä¹‰æ•°æ®</h4>
                <div class="chart-container">
                    <ix-device-status-chart
                        id="device-custom"
                        chart-title="ç½‘ç»œè®¾å¤‡çŠ¶æ€"
                        y-axis-label="ç½‘ç»œæ®µ"
                        x-axis-label="è®¾å¤‡æ•°é‡"
                        data='{"åŠå…¬ç½‘": {"online": 80, "maintenance": 10, "error": 5, "offline": 3}, "ç”Ÿäº§ç½‘": {"online": 200, "maintenance": 25, "error": 15, "offline": 8}, "æµ‹è¯•ç½‘": {"online": 50, "maintenance": 8, "error": 2, "offline": 1}}'
                    ></ix-device-status-chart>
                </div>

                <div class="controls">
                    <button class="btn btn-primary" onclick="updateDeviceData()">æ›´æ–°æ•°æ®</button>
                    <button class="btn btn-secondary" onclick="resetDeviceData()">é‡ç½®æ•°æ®</button>
                </div>

                <div class="test-info" id="device-test-info">ç­‰å¾…æµ‹è¯•ç»“æœ...</div>
            </div>

            <!-- StatusHistoryChart æµ‹è¯• -->
            <div class="test-section">
                <div class="section-title">ğŸ“‰ StatusHistoryChart æµ‹è¯•</div>

                <h4>é»˜è®¤é…ç½®</h4>
                <div class="chart-container">
                    <ix-status-history-chart id="status-default"></ix-status-history-chart>
                </div>

                <h4>å­£åº¦æ•°æ®</h4>
                <div class="chart-container">
                    <ix-status-history-chart
                        id="status-custom"
                        chart-title="å­£åº¦ç³»ç»ŸçŠ¶æ€è¶‹åŠ¿"
                        data='{"Q1": {"online": 15, "maintenance": -10, "error": -5, "offline": -80}, "Q2": {"online": 8, "maintenance": -20, "error": -15, "offline": -60}, "Q3": {"online": -5, "maintenance": -35, "error": -30, "offline": -45}, "Q4": {"online": 5, "maintenance": -15, "error": -10, "offline": -70}}'
                    ></ix-status-history-chart>
                </div>

                <div class="controls">
                    <button class="btn btn-primary" onclick="updateStatusData()">æ›´æ–°æ•°æ®</button>
                    <button class="btn btn-secondary" onclick="resetStatusData()">é‡ç½®æ•°æ®</button>
                </div>

                <div class="test-info" id="status-test-info">ç­‰å¾…æµ‹è¯•ç»“æœ...</div>
            </div>
        </div>

        <!-- å¯¹æ¯”æµ‹è¯• -->
        <div class="comparison-section">
            <div class="section-title">ğŸ”„ ç»„ä»¶å¯¹æ¯”åˆ†æ</div>
            <div class="comparison-grid">
                <div>
                    <h3>DeviceStatusChart (æ¡å½¢å›¾)</h3>
                    <div class="chart-container">
                        <ix-device-status-chart chart-title="å½“å‰è®¾å¤‡çŠ¶æ€"></ix-device-status-chart>
                    </div>
                    <div class="feature-list">
                        <h4>ç‰¹æ€§åˆ†æ</h4>
                        <ul>
                            <li>âœ… æ°´å¹³æ¡å½¢å›¾æ˜¾ç¤º</li>
                            <li>âœ… å¤šçŠ¶æ€å †å æ¡å½¢</li>
                            <li>âœ… åŠ¨æ€Yè½´æ ‡ç­¾</li>
                            <li>âœ… è‡ªåŠ¨ç¼©æ”¾ç½‘æ ¼</li>
                            <li>âœ… é¢œè‰²ç¼–ç çŠ¶æ€</li>
                            <li>âœ… å¯¼èˆªæŒ‰é’®</li>
                            <li>âœ… å›¾ä¾‹æ˜¾ç¤º</li>
                        </ul>
                    </div>
                </div>
                <div>
                    <h3>StatusHistoryChart (è¶‹åŠ¿çº¿å›¾)</h3>
                    <div class="chart-container">
                        <ix-status-history-chart chart-title="çŠ¶æ€å†å²è¶‹åŠ¿"></ix-status-history-chart>
                    </div>
                    <div class="feature-list">
                        <h4>ç‰¹æ€§åˆ†æ</h4>
                        <ul>
                            <li>âœ… SVGçº¿å›¾æ¸²æŸ“</li>
                            <li>âœ… å¤šçº¿è¶‹åŠ¿æ˜¾ç¤º</li>
                            <li>âœ… æ”¯æŒè´Ÿå€¼èŒƒå›´</li>
                            <li>âœ… æ—¶é—´è½´æ ‡ç­¾</li>
                            <li>âœ… ç½‘æ ¼çº¿å¯¹é½</li>
                            <li>âœ… æ•°æ®ç‚¹æ ‡è®°</li>
                            <li>âœ… åŠ¨æ€æ•°æ®æ›´æ–°</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- å‹åŠ›æµ‹è¯• -->
        <div class="test-section full-width">
            <div class="section-title">âš¡ æ€§èƒ½å’Œå‹åŠ›æµ‹è¯•</div>

            <div class="controls">
                <button class="btn btn-warning" onclick="runStressTest()">è¿è¡Œå‹åŠ›æµ‹è¯•</button>
                <button class="btn btn-secondary" onclick="runPerformanceTest()">æ€§èƒ½æµ‹è¯•</button>
                <button class="btn btn-primary" onclick="runCompatibilityTest()">å…¼å®¹æ€§æµ‹è¯•</button>
            </div>

            <div id="stress-test-container"></div>
            <div class="console-output" id="console-output">ç­‰å¾…æµ‹è¯•å¼€å§‹...</div>
        </div>
    </div>

    <!-- åŠ è½½åŠŸèƒ½æµ‹è¯•è„šæœ¬ -->
    <script src="test-components-functionality.js"></script>

    <script>
        // å…¨å±€æµ‹è¯•çŠ¶æ€
        let testResults = {
            deviceChart: { passed: 0, total: 0 },
            statusChart: { passed: 0, total: 0 },
            performance: { passed: 0, total: 0 }
        };

        // æ§åˆ¶å°è¾“å‡ºé‡å®šå‘
        const originalConsoleLog = console.log;
        const consoleOutput = document.getElementById('console-output');

        console.log = function(...args) {
            originalConsoleLog.apply(console, args);
            const message = args.join(' ');
            consoleOutput.textContent += message + '\n';
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        };

        // æ›´æ–°è®¾å¤‡çŠ¶æ€å›¾æ•°æ®
        function updateDeviceData() {
            const chart = document.getElementById('device-custom');
            const newData = {
                'æœåŠ¡å™¨': { online: Math.floor(Math.random() * 100), maintenance: Math.floor(Math.random() * 20), error: Math.floor(Math.random() * 10), offline: Math.floor(Math.random() * 5) },
                'ç½‘ç»œè®¾å¤‡': { online: Math.floor(Math.random() * 150), maintenance: Math.floor(Math.random() * 30), error: Math.floor(Math.random() * 15), offline: Math.floor(Math.random() * 8) },
                'å­˜å‚¨è®¾å¤‡': { online: Math.floor(Math.random() * 80), maintenance: Math.floor(Math.random() * 15), error: Math.floor(Math.random() * 8), offline: Math.floor(Math.random() * 3) }
            };
            chart.data = JSON.stringify(newData);
            console.log('DeviceStatusChart æ•°æ®å·²æ›´æ–°:', newData);
        }

        // é‡ç½®è®¾å¤‡çŠ¶æ€å›¾æ•°æ®
        function resetDeviceData() {
            const chart = document.getElementById('device-custom');
            const defaultData = {
                'åŠå…¬ç½‘': { online: 80, maintenance: 10, error: 5, offline: 3 },
                'ç”Ÿäº§ç½‘': { online: 200, maintenance: 25, error: 15, offline: 8 },
                'æµ‹è¯•ç½‘': { online: 50, maintenance: 8, error: 2, offline: 1 }
            };
            chart.data = JSON.stringify(defaultData);
            console.log('DeviceStatusChart æ•°æ®å·²é‡ç½®');
        }

        // æ›´æ–°çŠ¶æ€å†å²å›¾æ•°æ®
        function updateStatusData() {
            const chart = document.getElementById('status-custom');
            const timeLabels = ['Week 1', 'Week 2', 'Week 3', 'Week 4'];
            const newData = {};

            timeLabels.forEach(label => {
                newData[label] = {
                    online: Math.floor(Math.random() * 20),
                    maintenance: -Math.floor(Math.random() * 30),
                    error: -Math.floor(Math.random() * 20),
                    offline: -Math.floor(Math.random() * 100)
                };
            });

            chart.data = JSON.stringify(newData);
            console.log('StatusHistoryChart æ•°æ®å·²æ›´æ–°:', newData);
        }

        // é‡ç½®çŠ¶æ€å†å²å›¾æ•°æ®
        function resetStatusData() {
            const chart = document.getElementById('status-custom');
            const defaultData = {
                'Q1': { online: 15, maintenance: -10, error: -5, offline: -80 },
                'Q2': { online: 8, maintenance: -20, error: -15, offline: -60 },
                'Q3': { online: -5, maintenance: -35, error: -30, offline: -45 },
                'Q4': { online: 5, maintenance: -15, error: -10, offline: -70 }
            };
            chart.data = JSON.stringify(defaultData);
            console.log('StatusHistoryChart æ•°æ®å·²é‡ç½®');
        }

        // å‹åŠ›æµ‹è¯•
        function runStressTest() {
            console.log('\nğŸ”¥ å¼€å§‹å‹åŠ›æµ‹è¯•...');
            const container = document.getElementById('stress-test-container');
            container.innerHTML = '';

            // åˆ›å»ºå¤šä¸ªå›¾è¡¨å®ä¾‹
            for (let i = 0; i < 10; i++) {
                const deviceChart = document.createElement('ix-device-status-chart');
                deviceChart.style.display = 'inline-block';
                deviceChart.style.margin = '5px';
                deviceChart.style.transform = 'scale(0.3)';
                deviceChart.chartTitle = `è®¾å¤‡ ${i + 1}`;

                const statusChart = document.createElement('ix-status-history-chart');
                statusChart.style.display = 'inline-block';
                statusChart.style.margin = '5px';
                statusChart.style.transform = 'scale(0.3)';
                statusChart.chartTitle = `å†å² ${i + 1}`;

                container.appendChild(deviceChart);
                container.appendChild(statusChart);
            }

            console.log('âœ… å‹åŠ›æµ‹è¯•å®Œæˆï¼šåˆ›å»ºäº†20ä¸ªå›¾è¡¨å®ä¾‹');
        }

        // æ€§èƒ½æµ‹è¯•
        function runPerformanceTest() {
            console.log('\nâš¡ å¼€å§‹æ€§èƒ½æµ‹è¯•...');

            const startTime = performance.now();

            // æµ‹è¯•å¤§é‡æ•°æ®æ›´æ–°
            const chart = document.getElementById('device-custom');
            for (let i = 0; i < 100; i++) {
                const data = {
                    [`Range ${i}`]: {
                        online: Math.floor(Math.random() * 100),
                        maintenance: Math.floor(Math.random() * 20),
                        error: Math.floor(Math.random() * 10),
                        offline: Math.floor(Math.random() * 5)
                    }
                };
                chart.data = JSON.stringify(data);
            }

            const endTime = performance.now();
            const duration = endTime - startTime;

            console.log(`âœ… æ€§èƒ½æµ‹è¯•å®Œæˆï¼š100æ¬¡æ•°æ®æ›´æ–°è€—æ—¶ ${duration.toFixed(2)}ms`);
            console.log(`å¹³å‡æ¯æ¬¡æ›´æ–°è€—æ—¶ï¼š${(duration / 100).toFixed(2)}ms`);
        }

        // å…¼å®¹æ€§æµ‹è¯•
        function runCompatibilityTest() {
            console.log('\nğŸ”§ å¼€å§‹å…¼å®¹æ€§æµ‹è¯•...');

            const tests = [
                { name: 'Custom Elements API', test: () => typeof customElements !== 'undefined' },
                { name: 'Shadow DOM', test: () => document.createElement('div').attachShadow !== undefined },
                { name: 'SVG Support', test: () => document.createElementNS('http://www.w3.org/2000/svg', 'svg') instanceof SVGElement },
                { name: 'JSON Support', test: () => typeof JSON !== 'undefined' && typeof JSON.parse === 'function' },
                { name: 'ES6 Classes', test: () => { try { eval('class Test {}'); return true; } catch { return false; } } },
                { name: 'Template Literals', test: () => { try { eval('`test`'); return true; } catch { return false; } } }
            ];

            tests.forEach(({ name, test }) => {
                const result = test();
                console.log(`${result ? 'âœ…' : 'âŒ'} ${name}: ${result ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ'}`);
            });

            console.log('âœ… å…¼å®¹æ€§æµ‹è¯•å®Œæˆ');
        }

        // æµ‹è¯•ç»„ä»¶åŸºæœ¬åŠŸèƒ½
        function testBasicFunctionality() {
            console.log('\nğŸ§ª å¼€å§‹åŸºæœ¬åŠŸèƒ½æµ‹è¯•...');

            const deviceChart = document.getElementById('device-default');
            const statusChart = document.getElementById('status-default');

            const deviceInfo = document.getElementById('device-test-info');
            const statusInfo = document.getElementById('status-test-info');

            // æµ‹è¯• DeviceStatusChart
            setTimeout(() => {
                const deviceTests = [];

                if (deviceChart.shadowRoot) {
                    deviceTests.push('âœ… Shadow DOM å·²åˆ›å»º');

                    const title = deviceChart.shadowRoot.querySelector('.title');
                    if (title) deviceTests.push('âœ… æ ‡é¢˜å…ƒç´ å·²æ¸²æŸ“');

                    const bars = deviceChart.shadowRoot.querySelectorAll('.bar');
                    deviceTests.push(`âœ… æ¡å½¢å›¾å…ƒç´ : ${bars.length} ä¸ª`);

                    const legend = deviceChart.shadowRoot.querySelector('.legend');
                    if (legend) deviceTests.push('âœ… å›¾ä¾‹å·²æ¸²æŸ“');
                } else {
                    deviceTests.push('âŒ Shadow DOM æœªåˆ›å»º');
                }

                deviceInfo.innerHTML = deviceTests.join('<br>');
                console.log('DeviceStatusChart æµ‹è¯•ç»“æœ:', deviceTests);
            }, 1000);

            // æµ‹è¯• StatusHistoryChart
            setTimeout(() => {
                const statusTests = [];

                if (statusChart.shadowRoot) {
                    statusTests.push('âœ… Shadow DOM å·²åˆ›å»º');

                    const svg = statusChart.shadowRoot.querySelector('svg');
                    if (svg) {
                        statusTests.push('âœ… SVG å…ƒç´ å·²åˆ›å»º');

                        const paths = svg.querySelectorAll('path');
                        statusTests.push(`âœ… è¶‹åŠ¿çº¿: ${paths.length} æ¡`);

                        const circles = svg.querySelectorAll('circle');
                        statusTests.push(`âœ… æ•°æ®ç‚¹: ${circles.length} ä¸ª`);
                    }

                    const legend = statusChart.shadowRoot.querySelector('.legend');
                    if (legend) statusTests.push('âœ… å›¾ä¾‹å·²æ¸²æŸ“');
                } else {
                    statusTests.push('âŒ Shadow DOM æœªåˆ›å»º');
                }

                statusInfo.innerHTML = statusTests.join('<br>');
                console.log('StatusHistoryChart æµ‹è¯•ç»“æœ:', statusTests);
            }, 1000);
        }

        // æ›´æ–°æ•´ä½“çŠ¶æ€
        function updateOverallStatus() {
            const overallStatus = document.getElementById('overall-status');

            setTimeout(() => {
                const deviceDefined = customElements.get('ix-device-status-chart') !== undefined;
                const statusDefined = customElements.get('ix-status-history-chart') !== undefined;

                if (deviceDefined && statusDefined) {
                    overallStatus.className = 'status-good';
                    overallStatus.textContent = 'âœ… æ‰€æœ‰ç»„ä»¶å·²æˆåŠŸåŠ è½½å¹¶å¯ç”¨';
                } else {
                    overallStatus.className = 'status-error';
                    overallStatus.textContent = 'âŒ éƒ¨åˆ†ç»„ä»¶åŠ è½½å¤±è´¥';
                }
            }, 500);
        }

        // åˆå§‹åŒ–æµ‹è¯•
        Promise.all([
            customElements.whenDefined('ix-device-status-chart'),
            customElements.whenDefined('ix-status-history-chart')
        ]).then(() => {
            console.log('ğŸš€ æ‰€æœ‰ç»„ä»¶å·²å®šä¹‰ï¼Œå¼€å§‹æµ‹è¯•...');
            updateOverallStatus();
            testBasicFunctionality();

            // è¿è¡Œè‡ªåŠ¨åŒ–åŠŸèƒ½æµ‹è¯•
            if (typeof runTests === 'function') {
                setTimeout(runTests, 2000);
            }
        }).catch(error => {
            console.error('âŒ ç»„ä»¶åŠ è½½å¤±è´¥:', error);
            document.getElementById('overall-status').className = 'status-error';
            document.getElementById('overall-status').textContent = 'âŒ ç»„ä»¶åŠ è½½è¶…æ—¶æˆ–å¤±è´¥';
        });

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ“„ é¡µé¢åŠ è½½å®Œæˆï¼Œç­‰å¾…ç»„ä»¶åˆå§‹åŒ–...');
        });
    </script>
</body>
</html>
