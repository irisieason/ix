<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Final Reasonable Solution</title>
    <script type="module" src="./packages/core/dist/siemens-ix/siemens-ix.esm.js"></script>
    <link rel="stylesheet" href="./packages/core/dist/siemens-ix/siemens-ix.css">
    <style>
        body {
            background: #1a1a1a;
            color: white;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        .test-section {
            border: 1px solid #333;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
        }
        .success {
            background: rgba(1, 214, 90, 0.2);
            border-left: 4px solid #01d65a;
            color: #01d65a;
        }
        .error {
            background: rgba(255, 38, 64, 0.2);
            border-left: 4px solid #ff2640;
            color: #ff2640;
        }
        .info {
            background: rgba(255, 215, 50, 0.2);
            border-left: 4px solid #ffd732;
            color: #ffd732;
        }
    </style>
</head>
<body>
    <h1>üéØ Final Reasonable Solution Test</h1>
    <p>Testing the most reasonable, maintainable, and dynamic bar chart implementation.</p>

    <div class="test-section">
        <h2>Test 1: Default Data (Configuration-Driven)</h2>
        <ix-device-status-chart id="chart1"></ix-device-status-chart>
        <div id="result1" class="result info">Testing...</div>
    </div>

    <div class="test-section">
        <h2>Test 2: Dynamic Data Change</h2>
        <ix-device-status-chart id="chart2"></ix-device-status-chart>
        <button onclick="changeData()" style="margin: 10px 0; padding: 8px 16px; background: #333; color: white; border: 1px solid #555; border-radius: 4px; cursor: pointer;">Change Data Dynamically</button>
        <div id="result2" class="result info">Testing...</div>
    </div>

    <div class="test-section">
        <h2>Test 3: Custom Card Integration</h2>
        <ix-custom-card id="customCard"></ix-custom-card>
        <div id="result3" class="result info">Testing...</div>
    </div>

    <script>
        let dataChangeCount = 0;

        function changeData() {
            const chart = document.getElementById('chart2');
            const testData = [
                {
                    "Server A": {"success": 80, "warning": 15, "alarm": 3, "critical": 2},
                    "Server B": {"success": 120, "warning": 0, "alarm": 8, "critical": 0}
                },
                {
                    "Web Tier": {"success": 45, "warning": 5, "alarm": 1, "critical": 0},
                    "DB Tier": {"success": 25, "warning": 2, "alarm": 0, "critical": 1},
                    "Cache Tier": {"success": 30, "warning": 0, "alarm": 0, "critical": 0}
                },
                {
                    "Production": {"success": 200, "warning": 25, "alarm": 5, "critical": 2},
                    "Staging": {"success": 50, "warning": 8, "alarm": 2, "critical": 0}
                }
            ];

            const newData = testData[dataChangeCount % testData.length];
            chart.setAttribute('data', JSON.stringify(newData));
            dataChangeCount++;

            setTimeout(() => testChart('chart2', 'result2'), 500);
        }

        function testChart(chartId, resultId) {
            const chart = document.getElementById(chartId);
            const resultDiv = document.getElementById(resultId);

            if (!chart) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = '‚ùå Chart element not found';
                return false;
            }

            if (!chart.shadowRoot) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = '‚ùå Shadow root not found';
                return false;
            }

            const bars = chart.shadowRoot.querySelectorAll('.bar');
            const barContainers = chart.shadowRoot.querySelectorAll('.bar-container');

            if (bars.length === 0) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `‚ùå No bars found (${barContainers.length} containers exist)`;
                return false;
            }

            // Analyze bar types
            const barTypes = {
                success: chart.shadowRoot.querySelectorAll('.bar-success').length,
                warning: chart.shadowRoot.querySelectorAll('.bar-warning').length,
                alarm: chart.shadowRoot.querySelectorAll('.bar-alarm').length,
                critical: chart.shadowRoot.querySelectorAll('.bar-critical').length
            };

            resultDiv.className = 'result success';
            resultDiv.innerHTML = `‚úÖ SUCCESS: ${bars.length} bars found
Containers: ${barContainers.length}
Bar types: Success(${barTypes.success}) Warning(${barTypes.warning}) Alarm(${barTypes.alarm}) Critical(${barTypes.critical})`;

            return true;
        }

        // Run tests after components load
        setTimeout(() => {
            console.log('=== Final Reasonable Solution Test ===');

            const test1 = testChart('chart1', 'result1');
            const test2 = testChart('chart2', 'result2');
            const test3 = testChart('customCard', 'result3');

            const allPassed = test1 && test2 && test3;

            console.log(`\n=== FINAL RESULT ===`);
            console.log(allPassed ? 'üéâ ALL TESTS PASSED - REASONABLE SOLUTION WORKS!' : '‚ùå Some tests failed');

            // Add overall result
            const summary = document.createElement('div');
            summary.className = `result ${allPassed ? 'success' : 'error'}`;
            summary.innerHTML = `
                <h2>${allPassed ? 'üéâ SUCCESS: Reasonable Solution Works!' : '‚ùå FAILED: Issues Remain'}</h2>
                <p>${allPassed ? 'Configuration-driven, maintainable, and dynamic bar rendering is working correctly.' : 'There are still issues with the bar rendering implementation.'}</p>
            `;
            document.body.appendChild(summary);

        }, 3000);

        // Set initial data for chart2
        setTimeout(() => {
            const chart2 = document.getElementById('chart2');
            chart2.setAttribute('data', JSON.stringify({
                "Initial A": {"success": 60, "warning": 10, "alarm": 2, "critical": 1},
                "Initial B": {"success": 40, "warning": 5, "alarm": 1, "critical": 0}
            }));
        }, 1000);
    </script>
</body>
</html>
