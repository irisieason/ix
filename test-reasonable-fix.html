<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆç†ä¿®å¤æµ‹è¯•</title>
    <script type="module" src="./packages/core/dist/siemens-ix/siemens-ix.esm.js"></script>
    <link rel="stylesheet" href="./packages/core/dist/siemens-ix/siemens-ix.css">
    <style>
        body {
            background: #1a1a1a;
            color: white;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        .test-container {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
        }
        .success { background: rgba(1, 214, 90, 0.2); color: #01d65a; }
        .error { background: rgba(255, 38, 64, 0.2); color: #ff2640; }
    </style>
</head>
<body>
    <h1>ğŸ”§ åˆç†ä¿®å¤æµ‹è¯•</h1>
    <p>ä¿®å¤äº†æ•°æ®æµé—®é¢˜ï¼šchartDataåˆå§‹åŒ–ä¸ä¸ºç©º</p>

    <div class="test-container">
        <h3>è®¾å¤‡çŠ¶æ€å›¾è¡¨</h3>
        <ix-device-status-chart id="testChart"></ix-device-status-chart>
        <div id="result" class="result">æ£€æµ‹ä¸­...</div>
    </div>

    <script>
        console.log('ğŸ”§ å¼€å§‹åˆç†ä¿®å¤æµ‹è¯•');

        function checkBars() {
            const chart = document.getElementById('testChart');
            const resultDiv = document.getElementById('result');

            if (!chart) {
                resultDiv.className = 'result error';
                resultDiv.textContent = 'âŒ å›¾è¡¨å…ƒç´ æœªæ‰¾åˆ°';
                return;
            }

            if (!chart.shadowRoot) {
                resultDiv.className = 'result error';
                resultDiv.textContent = 'âŒ Shadow rootæœªæ‰¾åˆ°';
                return;
            }

            const bars = chart.shadowRoot.querySelectorAll('.bar');
            const visibleBars = Array.from(bars).filter(bar => {
                const style = window.getComputedStyle(bar);
                const rect = bar.getBoundingClientRect();
                return rect.width > 0 && rect.height > 0 && style.display !== 'none';
            });

            console.log(`æ‰¾åˆ° ${bars.length} ä¸ªæ¡å½¢å›¾å…ƒç´ ï¼Œ${visibleBars.length} ä¸ªå¯è§`);

            if (visibleBars.length > 0) {
                resultDiv.className = 'result success';
                resultDiv.textContent = `âœ… æˆåŠŸï¼${visibleBars.length} ä¸ªæ¡å½¢å›¾æ­£å¸¸æ˜¾ç¤º`;

                // æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
                visibleBars.forEach((bar, i) => {
                    const rect = bar.getBoundingClientRect();
                    console.log(`æ¡å½¢å›¾ ${i}: ${bar.className}, ${rect.width}x${rect.height}px`);
                });

            } else {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ æ¡å½¢å›¾æœªæ˜¾ç¤º (${bars.length} ä¸ªå…ƒç´ å­˜åœ¨ä½†ä¸å¯è§)`;

                // è°ƒè¯•ä¿¡æ¯
                bars.forEach((bar, i) => {
                    const style = window.getComputedStyle(bar);
                    const rect = bar.getBoundingClientRect();
                    console.log(`æ¡å½¢å›¾ ${i}: ${bar.className}, è®¡ç®—æ ·å¼: ${style.width}x${style.height}, å®é™…å°ºå¯¸: ${rect.width}x${rect.height}, æ˜¾ç¤º: ${style.display}`);
                });
            }
        }

        // ç­‰å¾…ç»„ä»¶åŠ è½½åæ£€æµ‹
        setTimeout(checkBars, 2000);
    </script>
</body>
</html>
