<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bar Chart Visibility Test</title>
    <script type="module" src="./packages/core/dist/siemens-ix/siemens-ix.esm.js"></script>
    <link rel="stylesheet" href="./packages/core/dist/siemens-ix/siemens-ix.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #1a1a1a;
            color: white;
            margin: 0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        h1, h2 {
            color: white;
            text-align: center;
        }
        .test-section {
            margin: 30px 0;
            padding: 20px;
            background: #2a2a2a;
            border-radius: 8px;
        }
        .card-container {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            padding: 20px;
            border: 2px dashed #555;
            border-radius: 8px;
        }
        .info-box {
            background: #333;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            margin: 20px 0;
        }
        .expected-data {
            background: #2d4a2d;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
        }
        .checklist {
            margin: 15px 0;
        }
        .checklist li {
            margin: 8px 0;
            padding: 5px;
            border-radius: 3px;
        }
        .pass {
            background-color: rgba(1, 214, 90, 0.2);
            color: #01d65a;
        }
        .fail {
            background-color: rgba(255, 38, 64, 0.2);
            color: #ff2640;
        }
        .pending {
            background-color: rgba(255, 215, 50, 0.2);
            color: #ffd732;
        }
        .color-sample {
            display: inline-block;
            width: 20px;
            height: 12px;
            margin-right: 8px;
            vertical-align: middle;
            border: 1px solid #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Bar Chart å¯è§æ€§æµ‹è¯•</h1>

        <div class="expected-data">
            <h3>æœŸæœ›çš„æ•°æ®æ˜¾ç¤ºï¼š</h3>
            <strong>3ä¸ªæ°´å¹³ Bar Chartï¼š</strong><br>
            â€¢ <span class="color-sample" style="background-color: #01d65a;"></span><strong>10.x</strong>: 60px ç»¿è‰²æ¡<br>
            â€¢ <span class="color-sample" style="background-color: #01d65a;"></span><strong>192.x</strong>: 250px ç»¿è‰² +
              <span class="color-sample" style="background-color: #ff2640;"></span>20px çº¢è‰² +
              <span class="color-sample" style="background-color: #ff9000;"></span>15px æ©™è‰²<br>
            â€¢ <span class="color-sample" style="background-color: #01d65a;"></span><strong>172.x</strong>: 180px ç»¿è‰² +
              <span class="color-sample" style="background-color: #ffd732;"></span>30px é»„è‰²<br><br>
            <strong>ç½‘æ ¼çº¿ç³»ç»Ÿï¼š</strong><br>
            â€¢ 7æ¡å‚ç›´çº¿ï¼ˆå¯¹åº” X è½´ï¼š0,3,6,9,12,15,18ï¼‰<br>
            â€¢ 4æ¡æ°´å¹³çº¿ï¼ˆ3è¡Œæ•°æ® + åº•éƒ¨è¾¹ç•Œï¼‰
        </div>

        <div class="test-section">
            <h2>ç»„ä»¶æ˜¾ç¤ºæµ‹è¯•</h2>
            <div class="card-container">
                <ix-custom-card id="test-card"></ix-custom-card>
            </div>
        </div>

        <div class="test-section">
            <h2>è¯¦ç»†æ£€æŸ¥ç»“æœ</h2>
            <div class="info-box">
                <ul class="checklist" id="check-results">
                    <li class="pending">ğŸ”„ æ£€æŸ¥ä¸­...</li>
                </ul>
            </div>
        </div>

        <div class="test-section">
            <h2>ä¿®å¤å»ºè®®</h2>
            <div class="info-box" id="fix-suggestions">
                ç­‰å¾…æ£€æŸ¥ç»“æœ...
            </div>
        </div>
    </div>

    <script>
        window.addEventListener('load', () => {
            setTimeout(() => {
                console.log('=== Bar Chart Visibility Test ===');

                const card = document.getElementById('test-card');
                const checkResults = document.getElementById('check-results');
                const fixSuggestions = document.getElementById('fix-suggestions');
                const results = [];

                if (!card || !card.shadowRoot) {
                    results.push({ text: 'âŒ ç»„ä»¶æœªæ‰¾åˆ°æˆ– Shadow DOM ä¸å¯ç”¨', class: 'fail' });
                    checkResults.innerHTML = results.map(r => `<li class="${r.class}">${r.text}</li>`).join('');
                    return;
                }

                const shadowRoot = card.shadowRoot;

                // æ£€æŸ¥ç½‘æ ¼çº¿
                const verticalLines = shadowRoot.querySelectorAll('.grid-line');
                const horizontalLines = shadowRoot.querySelectorAll('.horizontal-grid-line');
                const bottomLine = shadowRoot.querySelectorAll('.bottom-horizontal-line');

                results.push({
                    text: `å‚ç›´ç½‘æ ¼çº¿: ${verticalLines.length}/7 ä¸ª ${verticalLines.length === 7 ? 'âœ…' : 'âŒ'}`,
                    class: verticalLines.length === 7 ? 'pass' : 'fail'
                });

                results.push({
                    text: `æ°´å¹³ç½‘æ ¼çº¿: ${horizontalLines.length + bottomLine.length}/4 ä¸ª ${(horizontalLines.length + bottomLine.length) === 4 ? 'âœ…' : 'âŒ'}`,
                    class: (horizontalLines.length + bottomLine.length) === 4 ? 'pass' : 'fail'
                });

                // æ£€æŸ¥æŸ±çŠ¶å›¾
                const bars = shadowRoot.querySelectorAll('.bar');
                const barRows = shadowRoot.querySelectorAll('.bar-row');
                const barContainers = shadowRoot.querySelectorAll('.bar-container');

                results.push({
                    text: `Bar è¡Œæ•°: ${barRows.length}/3 ä¸ª ${barRows.length === 3 ? 'âœ…' : 'âŒ'}`,
                    class: barRows.length === 3 ? 'pass' : 'fail'
                });

                results.push({
                    text: `Bar å®¹å™¨: ${barContainers.length}/3 ä¸ª ${barContainers.length === 3 ? 'âœ…' : 'âŒ'}`,
                    class: barContainers.length === 3 ? 'pass' : 'fail'
                });

                results.push({
                    text: `Bar å…ƒç´ : ${bars.length} ä¸ª ${bars.length > 0 ? 'âœ…' : 'âŒ'}`,
                    class: bars.length > 0 ? 'pass' : 'fail'
                });

                // æ£€æŸ¥æ¯ä¸ª bar çš„æ ·å¼
                let visibleBars = 0;
                bars.forEach((bar, index) => {
                    const style = window.getComputedStyle(bar);
                    const hasBackground = style.backgroundColor !== 'rgba(0, 0, 0, 0)' &&
                                        style.backgroundColor !== 'transparent';
                    const hasWidth = parseInt(style.width) > 0;
                    const hasHeight = parseInt(style.height) > 0;

                    if (hasBackground && hasWidth && hasHeight) {
                        visibleBars++;
                    }

                    console.log(`Bar ${index + 1}:`, {
                        backgroundColor: style.backgroundColor,
                        width: style.width,
                        height: style.height,
                        display: style.display,
                        opacity: style.opacity,
                        visibility: style.visibility,
                        className: bar.className
                    });
                });

                results.push({
                    text: `å¯è§çš„ Bar: ${visibleBars}/${bars.length} ä¸ª ${visibleBars > 0 ? 'âœ…' : 'âŒ'}`,
                    class: visibleBars > 0 ? 'pass' : 'fail'
                });

                // æ£€æŸ¥å…·ä½“çš„ bar ç±»å‹
                const successBars = shadowRoot.querySelectorAll('.bar.success');
                const warningBars = shadowRoot.querySelectorAll('.bar.warning');
                const alarmBars = shadowRoot.querySelectorAll('.bar.alarm');
                const criticalBars = shadowRoot.querySelectorAll('.bar.critical');

                results.push({
                    text: `Success bars: ${successBars.length} ä¸ª`,
                    class: successBars.length > 0 ? 'pass' : 'fail'
                });

                results.push({
                    text: `Warning bars: ${warningBars.length} ä¸ª`,
                    class: warningBars.length > 0 ? 'pass' : 'pending'
                });

                results.push({
                    text: `Alarm bars: ${alarmBars.length} ä¸ª`,
                    class: alarmBars.length > 0 ? 'pass' : 'pending'
                });

                results.push({
                    text: `Critical bars: ${criticalBars.length} ä¸ª`,
                    class: criticalBars.length > 0 ? 'pass' : 'pending'
                });

                // æ›´æ–°ç»“æœæ˜¾ç¤º
                checkResults.innerHTML = results.map(result =>
                    `<li class="${result.class}">${result.text}</li>`
                ).join('');

                // ç”Ÿæˆä¿®å¤å»ºè®®
                const failedChecks = results.filter(r => r.class === 'fail');
                let suggestions = '';

                if (failedChecks.length === 0) {
                    suggestions = 'ğŸ‰ æ‰€æœ‰æ£€æŸ¥éƒ½é€šè¿‡äº†ï¼Bar Chart å’Œç½‘æ ¼çº¿åº”è¯¥éƒ½æ­£ç¡®æ˜¾ç¤ºã€‚';
                } else {
                    suggestions = '<strong>éœ€è¦ä¿®å¤çš„é—®é¢˜ï¼š</strong><br>';

                    if (bars.length === 0) {
                        suggestions += 'â€¢ Bar å…ƒç´ å®Œå…¨ç¼ºå¤± - æ£€æŸ¥ HTML ç»“æ„<br>';
                    } else if (visibleBars === 0) {
                        suggestions += 'â€¢ Bar å…ƒç´ å­˜åœ¨ä½†ä¸å¯è§ - æ£€æŸ¥ CSS æ ·å¼ï¼ˆé«˜åº¦ã€å®½åº¦ã€èƒŒæ™¯è‰²ï¼‰<br>';
                    }

                    if (verticalLines.length !== 7) {
                        suggestions += 'â€¢ å‚ç›´ç½‘æ ¼çº¿æ•°é‡ä¸æ­£ç¡®<br>';
                    }

                    if ((horizontalLines.length + bottomLine.length) !== 4) {
                        suggestions += 'â€¢ æ°´å¹³ç½‘æ ¼çº¿æ•°é‡ä¸æ­£ç¡®<br>';
                    }

                    suggestions += '<br><strong>å»ºè®®çš„è§£å†³æ–¹æ¡ˆï¼š</strong><br>';
                    suggestions += '1. ç¡®ä¿ .bar å…ƒç´ æœ‰å›ºå®šçš„é«˜åº¦å’Œå®½åº¦<br>';
                    suggestions += '2. ä½¿ç”¨ !important ç¡®ä¿èƒŒæ™¯è‰²ä¸è¢«è¦†ç›–<br>';
                    suggestions += '3. æ£€æŸ¥ .bar-container çš„å¸ƒå±€<br>';
                    suggestions += '4. éªŒè¯ç½‘æ ¼çº¿çš„ CSS æ ·å¼';
                }

                fixSuggestions.innerHTML = suggestions;

                console.log('Bar Chart Test Results:', {
                    totalBars: bars.length,
                    visibleBars: visibleBars,
                    verticalLines: verticalLines.length,
                    horizontalLines: horizontalLines.length + bottomLine.length,
                    results: results
                });
            }, 2000);
        });
    </script>
</body>
</html>
