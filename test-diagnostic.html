<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯Šæ–­æµ‹è¯• - æ‰¾å‡ºæ¡å½¢å›¾é—®é¢˜</title>
    <script type="module" src="./packages/core/dist/siemens-ix/siemens-ix.esm.js"></script>
    <link rel="stylesheet" href="./packages/core/dist/siemens-ix/siemens-ix.css">
    <style>
        body {
            background: #1a1a1a;
            color: white;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        .diagnostic-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .chart-wrapper {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .console-output {
            background: #000;
            color: #0f0;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ” è¯Šæ–­æµ‹è¯• - æ‰¾å‡ºæ¡å½¢å›¾é—®é¢˜</h1>

    <div class="diagnostic-section">
        <h3>æµ‹è¯•ç»„ä»¶</h3>
        <div class="chart-wrapper">
            <ix-device-status-chart id="diagnosticChart"></ix-device-status-chart>
        </div>
        <div class="console-output" id="consoleOutput">ç­‰å¾…æ§åˆ¶å°è¾“å‡º...</div>
    </div>

    <script>
        console.log('ğŸ” å¼€å§‹è¯Šæ–­æµ‹è¯•');

        // æ•è·æ§åˆ¶å°è¾“å‡º
        const consoleDiv = document.getElementById('consoleOutput');
        const originalLog = console.log;
        const originalWarn = console.warn;

        function addToConsoleOutput(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'warn' ? '#ff0' : '#0f0';
            consoleDiv.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }

        console.log = function(...args) {
            originalLog.apply(console, args);
            addToConsoleOutput(args.join(' '), 'log');
        };

        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addToConsoleOutput(args.join(' '), 'warn');
        };

        // ç­‰å¾…ç»„ä»¶åŠ è½½
        setTimeout(() => {
            console.log('æ£€æŸ¥ç»„ä»¶çŠ¶æ€...');

            const chart = document.getElementById('diagnosticChart');
            if (!chart) {
                console.warn('ç»„ä»¶å…ƒç´ æœªæ‰¾åˆ°');
                return;
            }

            console.log('ç»„ä»¶å…ƒç´ å­˜åœ¨:', chart.tagName);

            if (!chart.shadowRoot) {
                console.warn('Shadow rootæœªæ‰¾åˆ°');
                return;
            }

            console.log('Shadow rootå­˜åœ¨');

            // æ£€æŸ¥DOMç»“æ„
            const bars = chart.shadowRoot.querySelectorAll('.bar');
            const barContainers = chart.shadowRoot.querySelectorAll('.bar-container');
            const chartRows = chart.shadowRoot.querySelectorAll('.chart-row');

            console.log(`DOMç»“æ„: ${chartRows.length} è¡Œ, ${barContainers.length} å®¹å™¨, ${bars.length} æ¡å½¢å›¾`);

            // æ£€æŸ¥æ¯ä¸ªæ¡å½¢å›¾çš„æ ·å¼
            bars.forEach((bar, index) => {
                const style = window.getComputedStyle(bar);
                const rect = bar.getBoundingClientRect();
                console.log(`æ¡å½¢å›¾ ${index}: ç±»å=${bar.className}, å®½åº¦=${style.width}, é«˜åº¦=${style.height}, æ˜¾ç¤º=${style.display}, èƒŒæ™¯=${style.backgroundColor}, å®é™…å°ºå¯¸=${rect.width}x${rect.height}`);
            });

            if (bars.length === 0) {
                console.warn('æ²¡æœ‰æ‰¾åˆ°æ¡å½¢å›¾å…ƒç´ ');

                // æ£€æŸ¥æ˜¯å¦æœ‰bar-container
                barContainers.forEach((container, index) => {
                    console.log(`å®¹å™¨ ${index} å†…å®¹:`, container.innerHTML);
                });
            }

        }, 3000);
    </script>
</body>
</html>
