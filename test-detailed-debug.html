<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detailed Bar Chart Debug</title>
    <script type="module" src="./packages/core/dist/siemens-ix/siemens-ix.esm.js"></script>
    <link rel="stylesheet" href="./packages/core/dist/siemens-ix/siemens-ix.css">
    <style>
        body {
            margin: 0;
            padding: 20px;
            background-color: #1a1a1a;
            color: white;
            font-family: Arial, sans-serif;
        }
        .debug-info {
            background-color: #2a2a2a;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 11px;
            max-height: 400px;
            overflow-y: auto;
        }
        .test-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .chart-wrapper {
            border: 2px solid #333;
            padding: 10px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="debug-info">
        <h3>Debug Information:</h3>
        <div id="debug-output">Loading...</div>
    </div>

    <div class="test-container">
        <div class="chart-wrapper">
            <h3>Test Chart</h3>
            <ix-device-status-chart
                id="test-chart"
                chart-title="Debug Test"
                y-axis-label="Category"
                x-axis-label="Count">
            </ix-device-status-chart>
        </div>
    </div>

    <script>
        function deepDebug() {
            const chart = document.getElementById('test-chart');
            const debugOutput = document.getElementById('debug-output');

            // Set test data
            const testData = {
                'Test A': { success: 50, warning: 20, alarm: 10, critical: 5 },
                'Test B': { success: 30, warning: 15, alarm: 8, critical: 3 }
            };

            console.log('Setting test data:', testData);
            chart.data = testData;

            setTimeout(() => {
                let debugInfo = `
=== COMPONENT DEBUG ===
Chart Element: ${chart ? 'Found' : 'Not Found'}
Chart Tag: ${chart.tagName}
Data Property: ${JSON.stringify(chart.data)}
Chart Title: ${chart.chartTitle}
Y-axis Label: ${chart.yAxisLabel}
X-axis Label: ${chart.xAxisLabel}

=== SHADOW DOM DEBUG ===
Shadow Root: ${chart.shadowRoot ? 'Present' : 'Missing'}
                `;

                if (chart.shadowRoot) {
                    const shadowRoot = chart.shadowRoot;

                    // Check all relevant elements
                    const elements = {
                        'chart-container': shadowRoot.querySelectorAll('.chart-container'),
                        'chart-rows': shadowRoot.querySelectorAll('.chart-rows'),
                        'chart-row': shadowRoot.querySelectorAll('.chart-row'),
                        'bar-container': shadowRoot.querySelectorAll('.bar-container'),
                        'bar': shadowRoot.querySelectorAll('.bar'),
                        'bar-success': shadowRoot.querySelectorAll('.bar-success'),
                        'bar-warning': shadowRoot.querySelectorAll('.bar-warning'),
                        'bar-alarm': shadowRoot.querySelectorAll('.bar-alarm'),
                        'bar-critical': shadowRoot.querySelectorAll('.bar-critical'),
                        'y-scale-item': shadowRoot.querySelectorAll('.y-scale-item'),
                        'x-scale-item': shadowRoot.querySelectorAll('.x-scale-item'),
                        'legend-item': shadowRoot.querySelectorAll('.legend-item')
                    };

                    debugInfo += '\n=== ELEMENT COUNTS ===\n';
                    Object.entries(elements).forEach(([name, nodeList]) => {
                        debugInfo += `${name}: ${nodeList.length}\n`;
                    });

                    // Check bar elements in detail
                    const bars = shadowRoot.querySelectorAll('.bar');
                    debugInfo += '\n=== BAR ELEMENTS DETAIL ===\n';
                    bars.forEach((bar, i) => {
                        const computedStyle = window.getComputedStyle(bar);
                        debugInfo += `Bar ${i}:
  - Class: ${bar.className}
  - Style attr: ${bar.getAttribute('style')}
  - Computed width: ${computedStyle.width}
  - Computed height: ${computedStyle.height}
  - Computed display: ${computedStyle.display}
  - Computed position: ${computedStyle.position}
  - Computed background: ${computedStyle.backgroundColor}
  - Title: ${bar.getAttribute('title')}
  - Parent: ${bar.parentElement?.className}
\n`;
                    });

                    // Check bar containers
                    const barContainers = shadowRoot.querySelectorAll('.bar-container');
                    debugInfo += '\n=== BAR CONTAINERS ===\n';
                    barContainers.forEach((container, i) => {
                        const computedStyle = window.getComputedStyle(container);
                        debugInfo += `Container ${i}:
  - Children count: ${container.children.length}
  - Computed width: ${computedStyle.width}
  - Computed height: ${computedStyle.height}
  - Computed position: ${computedStyle.position}
  - Computed top: ${computedStyle.top}
  - Computed left: ${computedStyle.left}
\n`;
                    });

                    // Check Y-axis labels
                    const yLabels = shadowRoot.querySelectorAll('.y-scale-item');
                    debugInfo += '\n=== Y-AXIS LABELS ===\n';
                    yLabels.forEach((label, i) => {
                        debugInfo += `Y-Label ${i}: ${label.textContent}\n`;
                    });

                    // Check X-axis labels
                    const xLabels = shadowRoot.querySelectorAll('.x-scale-item');
                    debugInfo += '\n=== X-AXIS LABELS ===\n';
                    xLabels.forEach((label, i) => {
                        debugInfo += `X-Label ${i}: ${label.textContent}\n`;
                    });
                }

                debugOutput.innerHTML = `<pre>${debugInfo}</pre>`;

                // Also log to console for easier inspection
                console.log('Debug Info:', debugInfo);

            }, 2000); // Wait longer for component to fully render
        }

        // Run debug after component loads
        setTimeout(deepDebug, 1000);
    </script>
</body>
</html>
